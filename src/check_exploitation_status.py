from risk_assesment import risk_assessment


def check_exploitation_status(testing_report):
    """
    This function takes in the results from the attempted exploit and checks whether it was successful.

    Args:
        testing_report (dict): The results from the attempted exploit.

    Returns:
        dict: A report that contains successful exploitations passed for risk assessment
              and failed exploitations documented in the final report.
    """

    final_report = {
        "risk_level": testing_report["risk_level"],
        "total_devices": testing_report["total_devices"],
        "vulnerable_devices": testing_report["vulnerable_devices"],
        "exploitation_summary": []
    }

    for exploit_report in testing_report["exploit_reports"]:
        exploitation_status = {
            "ip_address": exploit_report["ip_address"],
            "operating_system": exploit_report["operating_system"],
            "risk_level": exploit_report["risk_level"],
            "successful_exploitations": [],
            "failed_exploitations": []
        }

        # Check each result in the simulation results
        for result in exploit_report["exploit_simulation_results"]:
            if result["simulation_success_probability"] == "High":
                # Successful exploit, proceed to risk assessment
                successful_exploit = {
                    "vulnerability": result["vulnerability"],
                    "exploitability_score": result["exploitability_score"],
                    "potential_impact": result["potential_impact"],
                    "simulation_status": "Exploitation Successful"
                }
                exploitation_status["successful_exploitations"].append(
                    successful_exploit)

                # Perform risk assessment (pseudo-function call)
                risk_assessment(successful_exploit)

            else:
                # Add to final report as failed exploitation
                failed_exploit = {
                    "vulnerability": result["vulnerability"],
                    "exploitability_score": result["exploitability_score"],
                    "potential_impact": result["potential_impact"],
                    "simulation_status": "Exploitation Failed"
                }
                exploitation_status["failed_exploitations"].append(
                    failed_exploit)

        final_report["exploitation_summary"].append(exploitation_status)

    return final_report
