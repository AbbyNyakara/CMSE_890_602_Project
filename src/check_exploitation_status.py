from risk_assesment import risk_assessment


def check_exploitation_status(testing_report):
    """
    This function takes in the results from the attempted exploit and checks whether it was successful.

    Args:
        testing_report (dict): The results from the attempted exploit.

    Returns:
        list: A list of all exploitations (both successful and unsuccessful) to be passed for risk assessment.
    """

    all_exploitations = []

    for exploit_report in testing_report.get("exploit_reports", []):
        for result in exploit_report.get("exploit_simulation_results", []):
            exploit_data = {
                "ip_address": exploit_report.get("ip_address"),
                "operating_system": exploit_report.get("operating_system"),
                "vulnerability": result.get("vulnerability"),
                "exploitability_score": result.get("exploitability_score"),
                "potential_impact": result.get("potential_impact"),
                "simulation_status": "Exploitation Successful" if result.get("simulation_success_probability") == "High" else "Exploitation Failed"
            }

            all_exploitations.append(exploit_data)

            risk_assessment(exploit_data)

    return all_exploitations
